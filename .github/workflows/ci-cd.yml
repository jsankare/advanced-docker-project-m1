name: Debug CI/CD

on:
  push:
    branches: [ feat/bonus ]
  workflow_dispatch:

jobs:
  debug:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Check repository structure
        run: |
          echo "=== Repository structure ==="
          ls -la
          echo ""
          echo "=== e-commerce-vue-main content ==="
          if [ -d "e-commerce-vue-main" ]; then
            ls -la e-commerce-vue-main/
            echo ""
            echo "=== Services ==="
            ls -la e-commerce-vue-main/services/ || echo "No services directory"
            echo ""
            echo "=== Frontend ==="
            ls -la e-commerce-vue-main/frontend/ || echo "No frontend directory"
          else
            echo "e-commerce-vue-main directory not found"
          fi
      
      - name: Check for package.json files
        run: |
          echo "=== Looking for package.json files ==="
          find . -name "package.json" -type f
          echo ""
          echo "=== Looking for package-lock.json files ==="
          find . -name "package-lock.json" -type f

  test-one-service:
    runs-on: ubuntu-latest
    needs: debug
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "18"
      
      - name: Test auth-service
        run: |
          if [ -d "e-commerce-vue-main/services/auth-service" ]; then
            cd e-commerce-vue-main/services/auth-service
            echo "Installing dependencies..."
            npm install
            echo "Running tests..."
            npm test || echo "Tests failed or no tests configured"
          else
            echo "auth-service directory not found"
            exit 1
          fi